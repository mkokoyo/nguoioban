<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ng∆∞·ªùi ·ªû B·∫£n - K·∫øt n·ªëi y√™u th∆∞∆°ng</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #ff4757; --bg: #ffffff; }
        [v-cloak] { display: none !important; }
        
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: #1a1a1a; line-height: 1.6; }
        header { padding: 25px 0; text-align: center; border-bottom: 5px solid var(--primary); background: #fff; position: sticky; top: 0; z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .logo { font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: clamp(20px, 5vw, 32px); letter-spacing: 4px; text-transform: uppercase; cursor: pointer; }
        .logo span { color: var(--primary); }
        
        .container { max-width: 1260px; margin: 0 auto; padding: 0 15px; }

        /* Main Player Section */
        .player-grid { display: grid; grid-template-columns: 1fr 350px; gap: 25px; margin: 25px 0; }
        .video-main { width: 100%; position: relative; padding-bottom: 56.25%; background: #000; border-radius: 16px; overflow: hidden; }
        .video-main iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

        .video-detail h1 { font-size: 22px; margin: 15px 0 10px; font-weight: 800; color: #000; }
        .stats-row { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; font-size: 14px; }
        .btn-like { cursor: pointer; border: 1.5px solid #ddd; padding: 8px 18px; border-radius: 30px; background: #fff; font-weight: bold; transition: 0.2s; }
        .btn-like.active { background: var(--primary); color: #fff; border-color: var(--primary); }

        /* Sidebar */
        .sidebar { background: #fcfcfc; border-radius: 16px; padding: 20px; border: 1px solid #eee; }
        .side-card { display: flex; gap: 12px; margin-bottom: 15px; cursor: pointer; }
        .side-card img { width: 110px; height: 62px; border-radius: 8px; object-fit: cover; }
        .side-card .title { font-size: 13px; font-weight: 700; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* Categories with Colors */
        .cat-box { margin-top: 40px; }
        .cat-header { display: flex; align-items: center; justify-content: space-between; padding: 12px 15px; border-radius: 8px; margin-bottom: 20px; }
        .cat-name { font-weight: 900; text-transform: uppercase; margin: 0; font-size: 18px; }

        /* Styles cho t·ª´ng lo·∫°i chuy√™n m·ª•c */
        .cat-video-ng·∫Øn { background: #fff5f6; border-left: 6px solid #ff4757; color: #ff4757; }
        .cat-cu·ªôc-s·ªëng-th∆∞·ªùng-ng√†y { background: #f0fff4; border-left: 6px solid #2ed573; color: #2ed573; }
        .cat-·∫©m-th·ª±c-l√†ng-qu√™ { background: #fffaf0; border-left: 6px solid #ffa502; color: #ffa502; }
        .cat-g√≥c-kh√°m-ph√° { background: #f0f7ff; border-left: 6px solid #1e90ff; color: #1e90ff; }

        /* Grid Video */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; }
        .v-item { cursor: pointer; }
        .v-item img { width: 100%; aspect-ratio: 16/9; border-radius: 12px; object-fit: cover; transition: 0.3s; }
        .v-item:hover img { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
        .v-item h4 { 
            margin: 10px 0 5px; font-size: 14px; font-weight: 700; 
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; 
            overflow: hidden; min-height: 40px; 
        }
        .v-info { font-size: 12px; color: #888; }

        @media (max-width: 992px) { .player-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div id="app" v-cloak>
    <header>
        <div class="logo" @click="adminLogin">NG∆Ø·ªúI ·ªû <span>B·∫¢N</span></div>
    </header>

    <div class="container" v-if="videos.length > 0">
        <div v-if="isAdm" style="margin:20px 0; padding:20px; border:2px dashed red; border-radius:15px;">
            <input v-model="newId" placeholder="M√£ ID Youtube (v√≠ d·ª•: aAbB123)" style="padding:10px; width:200px;">
            <select v-model="newC" style="padding:10px;">
                <option v-for="c in cats" :value="c">{{c}}</option>
            </select>
            <button @click="saveVid" style="padding:10px 20px; background:red; color:white; border:none; cursor:pointer;">L∆ØU VIDEO</button>
        </div>

        <div class="player-grid" v-if="cur">
            <div class="main-col">
                <div class="video-main">
                    <iframe :key="cur.id" :src="'https://www.youtube.com/embed/' + cur.id + '?autoplay=1&rel=0'" allowfullscreen allow="autoplay"></iframe>
                </div>
                <div class="video-detail">
                    <h1>{{ cur.title }}</h1>
                    <div class="stats-row">
                        <span>üëÅÔ∏è {{ cur.views || 0 }} l∆∞·ª£t xem</span>
                        <button class="btn-like" :class="{active: liked}" @click="doLike">‚ù§Ô∏è {{ cur.likes || 0 }} Th√≠ch</button>
                    </div>
                </div>
            </div>
            
            <div class="sidebar">
                <h3 style="margin:0 0 15px; font-size:14px; color:var(--primary)">XEM TI·∫æP</h3>
                <div v-for="v in suggest" :key="v.key" class="side-card" @click="play(v)">
                    <img :src="'https://img.youtube.com/vi/'+v.id+'/mqdefault.jpg'">
                    <div class="title">{{ v.title }}</div>
                </div>
            </div>
        </div>

        <div v-for="cat in cats" :key="cat" class="cat-box">
            <div v-if="filter(cat).length > 0">
                <div class="cat-header" :class="'cat-' + cat.toLowerCase().replace(/ /g, '-')">
                    <h3 class="cat-name">{{ cat }}</h3>
                </div>
                <div class="grid">
                    <div v-for="v in filter(cat)" :key="v.key" class="v-item" @click="play(v)">
                        <img :src="'https://img.youtube.com/vi/'+v.id+'/mqdefault.jpg'">
                        <h4>{{ v.title }}</h4>
                        <div class="v-info">üëÅÔ∏è {{ v.views }} ‚Ä¢ ‚ù§Ô∏è {{ v.likes }}</div>
                        <button v-if="isAdm" @click.stop="delVid(v.key)" style="color:red; margin-top:5px; border:none; background:none; cursor:pointer;">[X√≥a]</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div v-else style="text-align:center; padding:100px; font-weight:bold; color:#888;">
        ƒêang t·∫£i d·ªØ li·ªáu b·∫£n l√†ng...
    </div>

    <footer style="padding:60px; text-align:center; color:#ccc;">&copy; 2025 NG∆Ø·ªúI ·ªû B·∫¢N</footer>
</div>

<script>
// C·∫•u h√¨nh Firebase
const config = {
    apiKey: "AIzaSyC96V7VVvxtEpn9b-CXgc_6PCJCijCEDSI",
    authDomain: "nguoioban-77943.firebaseapp.com",
    databaseURL: "https://nguoioban-77943-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "nguoioban-77943",
    appId: "1:96090638378:web:84c6d4c9ae26a87869db53"
};

// ƒê·∫£m b·∫£o m·ªçi th·ª© ch·∫°y sau khi DOM s·∫µn s√†ng
document.addEventListener('DOMContentLoaded', function() {
    firebase.initializeApp(config);
    const db = firebase.database();
    const { createApp, ref, onMounted, computed } = Vue;

    createApp({
        setup() {
            const videos = ref([]);
            const cur = ref(null);
            const cats = ['Video ng·∫Øn', 'Cu·ªôc s·ªëng th∆∞·ªùng ng√†y', '·∫®m th·ª±c l√†ng qu√™', 'G√≥c kh√°m ph√°'];
            const isAdm = ref(false);
            const newId = ref('');
            const newC = ref('Video ng·∫Øn');
            const myIp = ref('');

            onMounted(async () => {
                // L·∫•y IP
                try {
                    const r = await fetch('https://api.ipify.org?format=json');
                    const d = await r.json();
                    myIp.value = d.ip.replace(/\./g, '_');
                } catch(e) { myIp.value = 'guest'; }

                // L·∫•y data t·ª´ Firebase
                db.ref('videos').on('value', snap => {
                    const val = snap.val();
                    if(val) {
                        const arr = Object.keys(val).map(k => ({key: k, ...val[k]})).reverse();
                        videos.value = arr;
                        if(!cur.value) cur.value = arr[0];
                        // C·∫≠p nh·∫≠t l·∫°i cur n·∫øu c√≥ thay ƒë·ªïi (like/view)
                        if(cur.value) {
                            const found = arr.find(x => x.key === cur.value.key);
                            if(found) cur.value = found;
                        }
                    }
                });
            });

            const play = (v) => {
                cur.value = v;
                db.ref(`videos/${v.key}/views`).transaction(v => (v || 0) + 1);
                window.scrollTo({top: 0, behavior: 'smooth'});
            };

            const doLike = () => {
                if(!cur.value || liked.value) return;
                db.ref(`videos/${cur.value.key}/likes`).transaction(l => (l || 0) + 1);
                db.ref(`videos/${cur.value.key}/voters/${myIp.value}`).set(true);
            };

            const liked = computed(() => {
                return cur.value && cur.value.voters && cur.value.voters[myIp.value];
            });

            const suggest = computed(() => {
                return videos.value.filter(x => x.id !== cur.value?.id).sort(() => 0.5 - Math.random()).slice(0, 5);
            });

            const filter = (c) => videos.value.filter(x => x.category === c);

            const adminLogin = () => {
                if(prompt("M·∫≠t kh·∫©u:") === 'cong1997') isAdm.value = true;
            };

            const saveVid = async () => {
                if(!newId.value) return;
                const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${newId.value}&key=AIzaSyBmx01zCKU5Z6XJcVTEurtcQrVq42iPSTM`);
                const data = await res.json();
                if(data.items && data.items[0]) {
                    db.ref('videos').push({
                        id: newId.value,
                        title: data.items[0].snippet.title,
                        category: newC.value,
                        views: 0, likes: 0
                    });
                    newId.value = ''; alert("Xong!");
                }
            };

            const delVid = (k) => { if(confirm("X√≥a?")) db.ref('videos/'+k).remove(); };

            return { videos, cur, cats, isAdm, newId, newC, saveVid, delVid, play, doLike, liked, suggest, filter, adminLogin };
        }
    }).mount('#app');
});
</script>
</body>
</html>
