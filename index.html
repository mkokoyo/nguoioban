<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Cloud Studio</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <style>
        :root { --bg: #050505; --card: #121212; --primary: #ff4757; --text: #eee; --gold: #f1c40f; --accent: #2ecc71; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }
        
        nav { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: #000; border-bottom: 1px solid #222; position: sticky; top:0; z-index:100; }
        .logo { font-weight: 900; font-size: 24px; color: var(--primary); text-transform: uppercase; }
        .btn-p { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-s { background: #333; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }

        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; }
        .hero { display: grid; grid-template-columns: 1.6fr 1fr; gap: 25px; }
        .player-main { background: var(--card); border-radius: 12px; overflow: hidden; }
        .video-ratio { position: relative; padding-bottom: 56.25%; height: 0; background: #000; }
        .video-ratio iframe { position: absolute; top:0; left:0; width:100%; height:100%; border:0; }
        
        /* B√¨nh lu·∫≠n & ƒê√°nh gi√° */
        .comment-section { margin-top: 25px; background: #111; padding: 20px; border-radius: 12px; }
        .star { cursor: pointer; font-size: 22px; color: #333; transition: 0.2s; }
        .star.active { color: var(--gold); }
        .comment-input { width: 100%; height: 80px; background: #000; color: #fff; border: 1px solid #333; border-radius: 8px; padding: 10px; margin: 10px 0; box-sizing: border-box; }

        .sidebar { background: var(--card); padding: 15px; border-radius: 12px; max-height: 600px; overflow-y: auto; }
        .side-card { display: flex; gap: 12px; cursor: pointer; margin-bottom: 15px; border-radius: 8px; transition: 0.2s; padding: 5px; }
        .side-card:hover { background: #222; }
        .side-card img { width: 140px; border-radius: 6px; aspect-ratio: 16/9; object-fit: cover; }

        .auth-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .auth-box { background: #1a1a1a; padding: 30px; border-radius: 12px; width: 320px; text-align: center; border: 1px solid #333; }
        
        .admin-panel { background: #1a1a1a; padding: 20px; border: 1px solid var(--primary); border-radius: 12px; margin-bottom: 30px; }
        input, select { padding: 12px; background: #000; color: #fff; border: 1px solid #333; border-radius: 8px; margin-bottom: 10px; width: 100%; box-sizing: border-box; }

        @media (max-width: 900px) { .hero { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div id="app">
    <nav>
        <div class="logo">GEMINI TV</div>
        <div class="nav-actions">
            <button v-if="!user" class="btn-p" @click="showAuth = true">ƒêƒÉng nh·∫≠p</button>
            <div v-else>
                <span style="color:var(--accent)">üë§ {{ user.name }}</span>
                <button @click="logout" style="margin-left:10px; background:none; color:gray; border:none; cursor:pointer;">Tho√°t</button>
                <button v-if="user.role === 'admin'" @click="isAdminMode = !isAdminMode" class="btn-p" style="margin-left:10px">‚öôÔ∏è Admin</button>
            </div>
        </div>
    </nav>

    <div v-if="showAuth" class="auth-modal">
        <div class="auth-box">
            <h3>Tham gia c·ªông ƒë·ªìng</h3>
            <p style="font-size: 12px; color: gray;">(D√πng t√™n 'admin' ƒë·ªÉ c√≥ quy·ªÅn ƒëƒÉng b√†i)</p>
            <input v-model="uInput" placeholder="T√™n c·ªßa b·∫°n">
            <button class="btn-p" style="width:100%" @click="login">B·∫Øt ƒë·∫ßu ngay</button>
            <button @click="showAuth = false" style="background:none; border:none; color:gray; margin-top:15px; cursor:pointer;">H·ªßy</button>
        </div>
    </div>

    <div class="container">
        <div v-if="isAdminMode" class="admin-panel">
            <h3 style="margin-top:0">üöÄ ƒêƒÉng Video M·ªõi (T·ª± ƒë·ªông ƒë·ªìng b·ªô)</h3>
            <div style="display:flex; gap:10px">
                <input v-model="tempId" placeholder="D√°n m√£ ID Youtube (v√≠ d·ª•: dQw4w9WgXcQ)">
                <button class="btn-p" style="height:45px" @click="postVideo">X√°c nh·∫≠n ƒêƒÉng</button>
            </div>
            <p style="font-size:12px; color:gray">H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông l·∫•y ti√™u ƒë·ªÅ v√† m√¥ t·∫£ t·ª´ YouTube API c·ªßa b·∫°n.</p>
        </div>

        <div class="hero">
            <div class="player-main">
                <div class="video-ratio">
                    <iframe :src="'https://www.youtube.com/embed/' + current.id" allowfullscreen></iframe>
                </div>
                <div style="padding:20px">
                    <h2 style="margin:0">{{ current.title }}</h2>
                    
                    <div class="comment-section">
                        <h3 style="margin-top:0">ƒê√°nh gi√° & B√¨nh lu·∫≠n</h3>
                        <div v-if="user">
                            <div style="margin-bottom:10px">
                                <span v-for="s in 5" class="star" :class="{active: s <= rating}" @click="rating = s">‚òÖ</span>
                                <span style="margin-left:10px; font-size:14px; color:var(--gold)">{{ rating }} / 5 sao</span>
                            </div>
                            <textarea class="comment-input" v-model="msg" placeholder="Chia s·∫ª c·∫£m nh·∫≠n c·ªßa b·∫°n v·ªÅ video n√†y..."></textarea>
                            <button class="btn-p" @click="sendComment">G·ª≠i b√¨nh lu·∫≠n</button>
                        </div>
                        <div v-else style="background:#000; padding:20px; border-radius:8px; text-align:center">
                            Vui l√≤ng <a href="#" @click="showAuth = true" style="color:var(--primary)">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ tham gia th·∫£o lu·∫≠n.
                        </div>

                        <div style="margin-top:25px">
                            <div v-for="c in comments" :key="c.time" style="padding:15px; border-bottom:1px solid #222; background:#161616; border-radius:8px; margin-bottom:10px">
                                <div style="display:flex; justify-content:space-between">
                                    <b style="color:var(--primary)">{{ c.name }}</b>
                                    <span style="color:var(--gold)">{{ '‚òÖ'.repeat(c.rating) }}</span>
                                </div>
                                <p style="margin:10px 0 0 0; font-size:14px; color:#ccc">{{ c.text }}</p>
                                <small style="color:#444; font-size:10px">{{ new Date(c.time).toLocaleString() }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <h3 style="margin-top:0; border-bottom:1px solid #333; padding-bottom:10px">Video kh√°c</h3>
                <div v-for="v in videos" :key="v.id" class="side-card" @click="current = v">
                    <img :src="'https://img.youtube.com/vi/'+v.id+'/mqdefault.jpg'">
                    <div>
                        <h4 style="margin:0; font-size:14px">{{ v.title }}</h4>
                        <small style="color:gray">D·ªØ li·ªáu t·ª´ ƒê√°m m√¢y</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// --- C·∫§U H√åNH FIREBASE C·ª¶A B·∫†N ---
const firebaseConfig = {
  apiKey: "AIzaSyC96V7VVvxtEpn9b-CXgc_6PCJCijCEDSI",
  authDomain: "nguoioban-77943.firebaseapp.com",
  projectId: "nguoioban-77943",
  storageBucket: "nguoioban-77943.firebasestorage.app",
  messagingSenderId: "96090638378",
  appId: "1:96090638378:web:84c6d4c9ae26a87869db53",
  measurementId: "G-9NQYEEXWBW",
  databaseURL: "https://nguoioban-77943-default-rtdb.asia-southeast1.firebasedatabase.app/" // ƒê√£ c·∫≠p nh·∫≠t ƒë√∫ng chu·∫©n URL
};

// YouTube API Key ƒë√£ c·∫•u h√¨nh tr∆∞·ªõc ƒë√≥
const YT_API_KEY = "AIzaSyBmx01zCKU5Z6XJcVTEurtcQrVq42iPSTM";

// Kh·ªüi t·∫°o Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const { createApp, ref, onMounted, watch } = Vue;

createApp({
    setup() {
        const user = ref(JSON.parse(localStorage.getItem('gemini_user')));
        const showAuth = ref(false);
        const uInput = ref("");
        const isAdminMode = ref(false);
        const videos = ref([]);
        const current = ref({id: 'dQw4w9WgXcQ', title: 'ƒêang t·∫£i video...'});
        const msg = ref("");
        const rating = ref(5);
        const comments = ref([]);
        const tempId = ref("");

        // T·∫£i Video t·ª´ Cloud
        onMounted(() => {
            db.ref('videos').on('value', snapshot => {
                const data = snapshot.val();
                videos.value = data ? Object.values(data).reverse() : [];
                if(videos.value.length > 0 && current.value.id === 'dQw4w9WgXcQ') {
                    current.value = videos.value[0];
                }
            });
        });

        // Theo d√µi Video hi·ªán t·∫°i ƒë·ªÉ t·∫£i b√¨nh lu·∫≠n t∆∞∆°ng ·ª©ng
        watch(() => current.value.id, (newId) => {
            db.ref('comments/' + newId).on('value', snapshot => {
                const data = snapshot.val();
                comments.value = data ? Object.values(data).reverse() : [];
            });
        }, { immediate: true });

        const login = () => {
            if(!uInput.value) return;
            const role = uInput.value.toLowerCase() === 'admin' ? 'admin' : 'user';
            user.value = { name: uInput.value, role };
            localStorage.setItem('gemini_user', JSON.stringify(user.value));
            showAuth.value = false;
        };

        const logout = () => {
            user.value = null;
            localStorage.removeItem('gemini_user');
            isAdminMode.value = false;
        };

        const postVideo = async () => {
            if(!tempId.value) return;
            try {
                const response = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${tempId.value}&key=${YT_API_KEY}`);
                const json = await response.json();
                if(json.items && json.items.length > 0) {
                    const title = json.items[0].snippet.title;
                    db.ref('videos').push({ id: tempId.value, title, time: Date.now() });
                    tempId.value = "";
                    alert("ƒêƒÉng b√†i th√†nh c√¥ng l√™n h·ªá th·ªëng!");
                } else { alert("ID Video kh√¥ng t·ªìn t·∫°i!"); }
            } catch (e) { alert("L·ªói khi k·∫øt n·ªëi YouTube API!"); }
        };

        const sendComment = () => {
            if(!msg.value) return;
            db.ref('comments/' + current.value.id).push({
                name: user.value.name,
                text: msg.value,
                rating: rating.value,
                time: Date.now()
            });
            msg.value = "";
            alert("ƒê√£ g·ª≠i b√¨nh lu·∫≠n!");
        };

        return { user, showAuth, uInput, isAdminMode, videos, current, msg, rating, comments, tempId, login, logout, postVideo, sendComment };
    }
}).mount('#app');
</script>
</body>
</html>
