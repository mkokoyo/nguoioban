<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Studio - Video & Community</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { --bg: #050505; --card: #121212; --primary: #ff4757; --text: #eee; --accent: #2ecc71; --gold: #f1c40f; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); }
        
        nav { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: #000; border-bottom: 1px solid #222; position: sticky; top:0; z-index:100; }
        .logo { font-weight: 900; font-size: 24px; color: var(--primary); text-transform: uppercase; }
        .nav-actions { display: flex; gap: 10px; align-items: center; }

        .container { max-width: 1400px; margin: 20px auto; padding: 0 20px; }

        /* Giao di·ªán ƒêƒÉng nh·∫≠p/ƒêƒÉng k√Ω */
        .auth-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .auth-box { background: #1a1a1a; padding: 30px; border-radius: 12px; width: 350px; border: 1px solid #333; }
        .auth-box input { width: 90%; padding: 12px; margin: 10px 0; background: #000; color: white; border: 1px solid #444; border-radius: 6px; }

        /* Hero Layout */
        .hero { display: grid; grid-template-columns: 1.6fr 1fr; gap: 25px; margin-bottom: 40px; }
        .player-main { background: var(--card); border-radius: 12px; overflow: hidden; }
        .video-ratio { position: relative; padding-bottom: 56.25%; height: 0; background: #000; }
        .video-ratio iframe { position: absolute; top:0; left:0; width:100%; height:100%; border:0; }
        
        /* B√¨nh lu·∫≠n & ƒê√°nh gi√° */
        .comment-section { margin-top: 25px; background: #111; padding: 20px; border-radius: 12px; }
        .star-rating { color: var(--gold); font-size: 20px; cursor: pointer; margin-bottom: 10px; }
        .comment-input { width: 100%; height: 80px; background: #000; color: #fff; border: 1px solid #333; border-radius: 8px; padding: 10px; box-sizing: border-box; }
        .comment-list { margin-top: 20px; }
        .comment-item { padding: 15px; border-bottom: 1px solid #222; }
        .user-tag { font-weight: bold; color: var(--primary); font-size: 14px; }

        /* Admin & Sidebar */
        .admin-box { background: #1a1a1a; padding: 20px; border-radius: 12px; border: 1px solid var(--primary); margin-bottom: 30px; }
        .sidebar { background: var(--card); padding: 15px; border-radius: 12px; max-height: 600px; overflow-y: auto; }
        .side-card { display: flex; gap: 12px; cursor: pointer; margin-bottom: 15px; }
        .side-card img { width: 130px; border-radius: 6px; }

        .btn-p { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-s { background: #333; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }

        @media (max-width: 900px) { .hero { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

<div id="app">
    <nav>
        <div class="logo">GEMINI STUDIO</div>
        <div class="nav-actions">
            <button v-if="!currentUser" class="btn-s" @click="showAuth = 'login'">ƒêƒÉng nh·∫≠p</button>
            <div v-else style="display:flex; gap:15px; align-items:center;">
                <span style="font-size:14px; color:var(--accent)">üëã Ch√†o, {{ currentUser.name }}</span>
                <button class="btn-s" style="padding:5px 10px; font-size:12px;" @click="logout">Tho√°t</button>
                <button v-if="currentUser.role === 'admin'" class="btn-p" @click="showAdmin = !showAdmin">Admin</button>
            </div>
        </div>
    </nav>

    <div v-if="showAuth" class="auth-modal">
        <div class="auth-box">
            <h3>{{ showAuth === 'login' ? 'ƒêƒÉng nh·∫≠p' : 'T·∫°o t√†i kho·∫£n' }}</h3>
            <input v-model="authForm.user" placeholder="T√™n t√†i kho·∫£n">
            <input type="password" v-model="authForm.pass" placeholder="M·∫≠t kh·∫©u">
            <button class="btn-p" style="width:100%" @click="handleAuth">{{ showAuth === 'login' ? 'V√†o h·ªá th·ªëng' : 'Ho√†n t·∫•t ƒëƒÉng k√Ω' }}</button>
            <p style="font-size:12px; color:gray; cursor:pointer; text-align:center" @click="showAuth = (showAuth === 'login' ? 'reg' : 'login')">
                {{ showAuth === 'login' ? 'Ch∆∞a c√≥ t√†i kho·∫£n? ƒêƒÉng k√Ω ngay' : 'ƒê√£ c√≥ t√†i kho·∫£n? ƒêƒÉng nh·∫≠p' }}
            </p>
            <button class="btn-s" style="width:100%; margin-top:5px" @click="showAuth = null">ƒê√≥ng</button>
        </div>
    </div>

    <div class="container">
        <div v-if="showAdmin" class="admin-box">
            <h3>üöÄ ƒêƒÉng Video Si√™u T·ªëc (D√†nh cho Admin)</h3>
            <div style="display:flex; gap:10px">
                <input v-model="tempId" placeholder="D√°n ID Youtube (v√≠ d·ª•: dQw4w9WgXcQ)" style="flex:1; padding:10px">
                <button class="btn-p" @click="autoFetch">L·∫•y d·ªØ li·ªáu</button>
            </div>
            <div v-if="preview" style="margin-top:15px; display:flex; gap:20px; align-items:center">
                <img :src="preview.thumb" width="150">
                <div>
                    <p><b>{{ preview.title }}</b></p>
                    <select v-model="selectedCat" style="padding:8px; background:#000; color:#fff">
                        <option value="short">Video Ng·∫Øn</option>
                        <option value="daily">Cu·ªôc s·ªëng</option>
                    </select>
                    <button class="btn-p" style="margin-left:10px" @click="confirmPost">ƒêƒÉng b√†i</button>
                </div>
            </div>
        </div>

        <div class="hero">
            <div class="player-main">
                <div class="video-ratio">
                    <iframe :src="'https://www.youtube.com/embed/' + current.id" allowfullscreen></iframe>
                </div>
                <div style="padding:20px">
                    <h2>{{ current.title }}</h2>
                    <p style="color:#aaa; font-size:14px">{{ current.desc }}</p>

                    <div class="comment-section">
                        <h3 style="margin-top:0">ƒê√°nh gi√° & B√¨nh lu·∫≠n</h3>
                        
                        <div v-if="currentUser">
                            <div class="star-rating">
                                <span v-for="s in 5" @click="userRating = s" :style="{color: s <= userRating ? 'var(--gold)' : '#333'}">‚òÖ</span>
                            </div>
                            <textarea class="comment-input" v-model="userComment" placeholder="Chia s·∫ª c·∫£m nghƒ© c·ªßa b·∫°n..."></textarea>
                            <button class="btn-p" style="margin-top:10px" @click="postComment">G·ª≠i b√¨nh lu·∫≠n</button>
                        </div>
                        <div v-else style="background:#222; padding:15px; border-radius:8px; text-align:center">
                            B·∫°n c·∫ßn <a href="#" @click="showAuth = 'login'" style="color:var(--primary)">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ b√¨nh lu·∫≠n v√† ƒë√°nh gi√°.
                        </div>

                        <div class="comment-list">
                            <div v-for="c in currentComments" class="comment-item">
                                <div class="user-tag">{{ c.userName }} <span style="color:var(--gold); margin-left:10px">{{ '‚òÖ'.repeat(c.rating) }}</span></div>
                                <div style="font-size:14px; margin-top:5px; color:#ccc">{{ c.text }}</div>
                                <div style="font-size:10px; color:#555; margin-top:5px">{{ c.time }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <h3 style="margin-top:0">ƒêang ƒë∆∞·ª£c quan t√¢m</h3>
                <div v-for="v in allVideos" class="side-card" @click="play(v)">
                    <img :src="v.thumb">
                    <div>
                        <h4 style="margin:0; font-size:14px">{{ v.title }}</h4>
                        <span style="font-size:11px; color:var(--primary)">{{ v.catName }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, onMounted, computed } = Vue;
const API_KEY = "AIzaSyBmx01zCKU5Z6XJcVTEurtcQrVq42iPSTM"; 

createApp({
    setup() {
        const showAuth = ref(null);
        const currentUser = ref(null);
        const showAdmin = ref(false);
        const authForm = ref({ user: '', pass: '' });

        const tempId = ref("");
        const preview = ref(null);
        const selectedCat = ref("short");
        const current = ref({ id: 'dQw4w9WgXcQ', title: 'Video Ch√†o M·ª´ng', desc: 'ƒêƒÉng nh·∫≠p ƒë·ªÉ b√¨nh lu·∫≠n' });

        const userRating = ref(5);
        const userComment = ref("");
        const allVideos = ref([]);
        const allComments = ref([]);

        onMounted(() => {
            const vData = localStorage.getItem('gemini_video_store');
            const cData = localStorage.getItem('gemini_comments');
            const uData = localStorage.getItem('gemini_current_user');
            if(vData) allVideos.value = JSON.parse(vData);
            if(cData) allComments.value = JSON.parse(cData);
            if(uData) currentUser.value = JSON.parse(uData);
            if(allVideos.value.length > 0) current.value = allVideos.value[0];
        });

        // H·ªÜ TH·ªêNG T√ÄI KHO·∫¢N (Gi·∫£ l·∫≠p)
        const handleAuth = () => {
            if(!authForm.value.user || !authForm.value.pass) return alert("Vui l√≤ng nh·∫≠p ƒë·ªß!");
            
            if(showAuth.value === 'reg') {
                const users = JSON.parse(localStorage.getItem('gemini_users') || '[]');
                users.push({ ...authForm.value, role: authForm.value.user === 'admin' ? 'admin' : 'user' });
                localStorage.setItem('gemini_users', JSON.stringify(users));
                alert("ƒêƒÉng k√Ω th√†nh c√¥ng!");
                showAuth.value = 'login';
            } else {
                const users = JSON.parse(localStorage.getItem('gemini_users') || '[]');
                const user = users.find(u => u.user === authForm.value.user && u.pass === authForm.value.pass);
                if(user) {
                    currentUser.value = { name: user.user, role: user.role };
                    localStorage.setItem('gemini_current_user', JSON.stringify(currentUser.value));
                    showAuth.value = null;
                } else alert("Sai t√†i kho·∫£n!");
            }
        };

        const logout = () => {
            currentUser.value = null;
            localStorage.removeItem('gemini_current_user');
            showAdmin.value = false;
        };

        // B√åNH LU·∫¨N
        const postComment = () => {
            if(!userComment.value) return;
            const comment = {
                videoId: current.value.id,
                userName: currentUser.value.name,
                rating: userRating.value,
                text: userComment.value,
                time: new Date().toLocaleString()
            };
            allComments.value.unshift(comment);
            localStorage.setItem('gemini_comments', JSON.stringify(allComments.value));
            userComment.value = "";
        };

        const currentComments = computed(() => {
            return allComments.value.filter(c => c.videoId === current.value.id);
        });

        // ADMIN FUNCTIONS (L·∫•y t·ª´ b·∫£n tr∆∞·ªõc)
        const autoFetch = async () => {
            try {
                const res = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${tempId.value}&key=${API_KEY}`);
                const json = await res.json();
                if(json.items.length > 0) {
                    const snip = json.items[0].snippet;
                    preview.value = { id: tempId.value, title: snip.title, desc: snip.description, thumb: snip.thumbnails.medium.url };
                }
            } catch (e) { alert("L·ªói API"); }
        };

        const confirmPost = () => {
            allVideos.value.unshift({ ...preview.value, cat: selectedCat.value, catName: selectedCat.value });
            localStorage.setItem('gemini_video_store', JSON.stringify(allVideos.value));
            preview.value = null; tempId.value = "";
        };

        const play = (v) => { current.value = v; window.scrollTo({ top: 0, behavior: 'smooth' }); };

        return { showAuth, currentUser, showAdmin, authForm, tempId, preview, selectedCat, current, userRating, userComment, allVideos, handleAuth, logout, postComment, currentComments, autoFetch, confirmPost, play };
    }
}).mount('#app');
</script>
</body>
</html>
