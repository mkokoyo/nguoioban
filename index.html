<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ng∆∞·ªùi ·ªû B·∫£n - B·∫£n Ho√†n Ch·ªânh V1</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --primary: #ff4757; --success: #2ed573; --bg: #f8f9fa; }
        [v-cloak] { display: none !important; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: #1a1a1a; line-height: 1.6; }
        
        header { padding: 20px 0; text-align: center; border-bottom: 5px solid var(--primary); background: #fff; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .logo { font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: 30px; letter-spacing: 4px; text-transform: uppercase; cursor: pointer; }
        .logo span { color: var(--primary); }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

        /* Modal Admin */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center; }
        .modal-box { background: #fff; padding: 30px; border-radius: 24px; width: 350px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .modal-box h3 { font-family: 'Montserrat'; margin-bottom: 20px; }
        .modal-box input { width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #eee; border-radius: 12px; box-sizing: border-box; font-size: 16px; outline: none; transition: 0.3s; }
        .modal-box input:focus { border-color: var(--primary); }
        .modal-box button { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%; }

        /* Layout Tr√¨nh Ph√°t */
        .layout { display: grid; grid-template-columns: 1fr 380px; gap: 30px; margin: 30px 0; }
        .v-main-container { width: 100%; position: relative; padding-bottom: 56.25%; background: #000; border-radius: 24px; overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.15); }
        #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        /* Th√¥ng tin video ch√≠nh */
        .v-info-card { margin-top: 25px; background: #fff; padding: 30px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .v-display-title { font-size: 28px; font-weight: 800; line-height: 1.3; margin: 0 0 20px 0; color: #111; display: block; }
        .v-meta-row { display: flex; align-items: center; flex-wrap: wrap; gap: 15px; }
        
        .playlist-tag { background: #fff5f6; color: var(--primary); padding: 8px 20px; border-radius: 12px; font-size: 14px; font-weight: 800; border: 1px solid rgba(255, 71, 87, 0.2); }
        
        .autoplay-wrapper { display: flex; align-items: center; gap: 10px; background: #f1f3f5; padding: 8px 18px; border-radius: 30px; cursor: pointer; transition: 0.3s; }
        .switch { position: relative; width: 36px; height: 18px; background: #adb5bd; border-radius: 20px; transition: 0.3s; }
        .switch::before { content: ""; position: absolute; width: 14px; height: 14px; background: #fff; border-radius: 50%; top: 2px; left: 2px; transition: 0.3s; }
        .autoplay-wrapper.on { background: #e7fcf0; }
        .autoplay-wrapper.on .switch { background: var(--success); }
        .autoplay-wrapper.on .switch::before { left: 20px; }
        .autoplay-text { font-size: 13px; font-weight: 700; color: #495057; }

        /* N√∫t Like & View tr√¨nh ph√°t */
        .stat-view { font-weight: 700; color: #666; background: #f8f9fa; padding: 10px 20px; border-radius: 30px; font-size: 15px; }
        .like-btn { 
            cursor: pointer; background: #fff; color: var(--primary); border: 2px solid var(--primary); 
            padding: 10px 25px; border-radius: 40px; font-weight: 800; transition: 0.3s; 
            display: flex; align-items: center; gap: 8px; box-shadow: 0 4px 12px rgba(255, 71, 87, 0.1);
        }
        .like-btn span { font-size: 18px; }
        .like-btn.active { background: var(--primary); color: #fff; box-shadow: 0 8px 20px rgba(255, 71, 87, 0.3); }
        .like-btn.active span { filter: brightness(0) invert(1); }
        .like-btn:hover { transform: translateY(-2px); }

        /* Sidebar */
        .sidebar { background: #fff; padding: 25px; border-radius: 24px; border: 1px solid #eee; height: fit-content; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        .side-head { font-weight: 900; color: var(--primary); font-size: 14px; text-transform: uppercase; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px; letter-spacing: 1px; }
        .side-item { display: flex; gap: 15px; margin-bottom: 20px; cursor: pointer; transition: 0.3s; }
        .side-item:hover { transform: translateX(5px); }
        .side-item img { width: 120px; border-radius: 12px; aspect-ratio: 16/9; object-fit: cover; }
        .side-txt { font-size: 14px; font-weight: 700; line-height: 1.4; color: #222; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

        /* Chuy√™n m·ª•c & Card */
        .cat-video-ng·∫Øn { --c: #ff4757; --b: #fff5f6; }
        .cat-cu·ªôc-s·ªëng-th∆∞·ªùng-ng√†y { --c: #2ed573; --b: #f0fff4; }
        .cat-·∫©m-th·ª±c-l√†ng-qu√™ { --c: #ffa502; --b: #fffaf0; }
        .cat-g√≥c-kh√°m-ph√° { --c: #1e90ff; --b: #f0f7ff; }

        .cat-head { background: var(--b); border-left: 8px solid var(--c); padding: 20px 30px; margin: 60px 0 30px; display: flex; justify-content: space-between; align-items: center; border-radius: 16px; }
        .cat-name { font-weight: 900; text-transform: uppercase; color: var(--c); font-size: 22px; margin: 0; letter-spacing: 1px; }
        
        .grid { display: grid; grid-template-columns: repeat(var(--cols, 5), 1fr); gap: 25px; }
        
        .card { 
            background: #fff; border-radius: 20px; overflow: hidden; cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 1px solid #eee; display: flex; flex-direction: column;
        }
        .card:hover { transform: translateY(-12px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); border-color: var(--c); }
        .card .thumb-box { width: 100%; aspect-ratio: 16/9; overflow: hidden; }
        .card img { width: 100%; height: 100%; object-fit: cover; transition: 0.6s; }
        .card:hover img { transform: scale(1.1); }
        
        .card-body { padding: 18px; flex-grow: 1; display: flex; flex-direction: column; }
        .card h4 { 
            margin: 0 0 15px 0; font-size: 15px; font-weight: 700; line-height: 1.5; 
            height: 45px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; color: #222;
        }
        
        .card-stats { display: flex; gap: 10px; margin-top: auto; }
        .badge { font-size: 12px; font-weight: 800; padding: 5px 12px; border-radius: 20px; display: flex; align-items: center; gap: 5px; }
        .badge-views { background: #f1f3f5; color: #666; }
        .badge-likes { background: var(--b); color: var(--c); }

        .nav-btn { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--c); background: #fff; color: var(--c); cursor: pointer; font-weight: bold; font-size: 18px; transition: 0.3s; }
        .nav-btn:hover:not(:disabled) { background: var(--c); color: #fff; }
        .nav-btn:disabled { opacity: 0.2; cursor: default; }

        footer { background: #121212; color: #fff; padding: 80px 0; text-align: center; margin-top: 100px; position: relative; }
        footer::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: linear-gradient(90deg, #ff4757, #2ed573, #ffa502, #1e90ff); }

        @media (max-width: 1300px) { :root { --cols: 4; } }
        @media (max-width: 1100px) { .layout { grid-template-columns: 1fr; } :root { --cols: 3; } }
        @media (max-width: 650px) { :root { --cols: 2; } .v-display-title { font-size: 22px; } }
    </style>
</head>
<body>

<div id="app" v-cloak>
    <div class="modal-overlay" v-if="showLogin">
        <div class="modal-box">
            <h3>QU·∫¢N TR·ªä VI√äN</h3>
            <input type="password" v-model="passInput" placeholder="Nh·∫≠p m√£ b·∫£o m·∫≠t..." @keyup.enter="checkPass">
            <button @click="checkPass">ƒêƒÇNG NH·∫¨P</button>
            <p @click="showLogin = false" style="margin-top:15px; color:gray; cursor:pointer; font-size:14px;">Quay l·∫°i trang ch·ªß</p>
        </div>
    </div>

    <header>
        <div class="logo" @click="showLogin = true">NG∆Ø·ªúI ·ªû <span>B·∫¢N</span></div>
    </header>

    <div class="container" v-if="vids.length > 0">
        <div v-if="isAdm" style="padding:30px; border:3px dashed var(--primary); border-radius:24px; background:#fff; margin: 30px 0; display:flex; gap:15px; align-items:center; box-shadow: 0 15px 30px rgba(0,0,0,0.05);">
            <div style="flex:1;">
                <label style="font-weight:800; font-size:12px; color:var(--primary); display:block; margin-bottom:5px;">ID YOUTUBE</label>
                <input v-model="newId" placeholder="V√≠ d·ª•: dQw4w9WgXcQ" style="width:100%; padding:12px; border-radius:12px; border:1px solid #ddd; box-sizing:border-box;">
            </div>
            <div style="width:200px;">
                <label style="font-weight:800; font-size:12px; color:var(--primary); display:block; margin-bottom:5px;">CHUY√äN M·ª§C</label>
                <select v-model="newCat" style="width:100%; padding:12px; border-radius:12px; border:1px solid #ddd; font-weight:bold;">
                    <option v-for="c in cats" :value="c">{{c}}</option>
                </select>
            </div>
            <button @click="saveVid" style="background:var(--primary); color:white; border:none; padding:15px 35px; border-radius:12px; cursor:pointer; font-weight:900; align-self:flex-end;">ƒêƒÇNG T·∫¢I VIDEO</button>
        </div>

        <div class="layout" v-if="cur">
            <div>
                <div class="v-main-container">
                    <div id="player"></div>
                </div>
                
                <div class="v-info-card">
                    <h1 class="v-display-title">{{ cur.title }}</h1>
                    <div class="v-meta-row">
                        <div class="playlist-tag">üìÇ {{ cur.category }}</div>
                        <div class="autoplay-wrapper" :class="{on: isAutoplay}" @click="isAutoplay = !isAutoplay">
                            <div class="switch"></div>
                            <span class="autoplay-text">T·ª± ƒë·ªông ph√°t ti·∫øp</span>
                        </div>
                        <div style="flex-grow: 1;"></div>
                        <div style="display:flex; gap:12px; align-items:center;">
                            <span class="stat-view">üëÅÔ∏è {{ cur.views || 0 }} xem</span>
                            <button class="like-btn" :class="{active: isLiked}" @click="vote">
                                <span>‚ù§Ô∏è</span> <b>{{ cur.likes || 0 }} Th√≠ch</b>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <div class="side-head">C√ì TH·ªÇ B·∫†N TH√çCH</div>
                <div v-for="v in suggest" :key="v.key" class="side-item" @click="play(v)">
                    <img :src="'https://img.youtube.com/vi/'+v.id+'/mqdefault.jpg'">
                    <div class="side-txt">{{ v.title }}</div>
                </div>
            </div>
        </div>

        <div v-for="cat in cats" :key="cat" :class="'cat-' + cat.toLowerCase().replace(/ /g, '-')">
            <div v-if="list(cat).length > 0">
                <div class="cat-head">
                    <h3 class="cat-name">{{ cat }}</h3>
                    <div v-if="list(cat).length > itemsPerPage" style="display:flex; gap:12px;">
                        <button class="nav-btn" @click="pMap[cat]--" :disabled="pMap[cat] === 0">‚ùÆ</button>
                        <button class="nav-btn" @click="pMap[cat]++" :disabled="isEnd(cat)">‚ùØ</button>
                    </div>
                </div>
                
                <div class="grid">
                    <div v-for="v in paged(cat)" :key="v.key" class="card" @click="play(v)">
                        <div class="thumb-box">
                            <img :src="'https://img.youtube.com/vi/'+v.id+'/mqdefault.jpg'">
                        </div>
                        <div class="card-body">
                            <h4>{{ v.title }}</h4>
                            <div class="card-stats">
                                <span class="badge badge-views">üëÅÔ∏è {{ v.views }}</span>
                                <span class="badge badge-likes">‚ù§Ô∏è {{ v.likes }}</span>
                            </div>
                            <button v-if="isAdm" @click.stop="del(v.key)" style="color:red; background:none; border:none; cursor:pointer; font-size:11px; margin-top:15px; font-weight:800; text-align:left;">[X√ìA VIDEO]</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <h2 style="font-family:'Montserrat'; font-weight:900; font-size:32px; letter-spacing:2px;">NG∆Ø·ªúI ·ªû <span style="color:var(--primary)">B·∫¢N</span></h2>
        <p style="color:#666; font-size:14px; margin-top:15px; font-weight:700; letter-spacing:1px;">G√åN GI·ªÆ V√Ä LAN T·ªéA B·∫¢N S·∫ÆC VI·ªÜT &copy; 2025</p>
    </footer>
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
const fbConfig = {
    apiKey: "AIzaSyC96V7VVvxtEpn9b-CXgc_6PCJCijCEDSI",
    authDomain: "nguoioban-77943.firebaseapp.com",
    databaseURL: "https://nguoioban-77943-default-rtdb.asia-southeast1.firebasedatabase.app/",
    projectId: "nguoioban-77943",
    appId: "1:96090638378:web:84c6d4c9ae26a87869db53"
};

let ytPlayer;
window.onload = function() {
    firebase.initializeApp(fbConfig);
    const db = firebase.database();
    const { createApp, ref, onMounted, computed } = Vue;

    createApp({
        setup() {
            const vids = ref([]);
            const cur = ref(null);
            const cats = ['Video ng·∫Øn', 'Cu·ªôc s·ªëng th∆∞·ªùng ng√†y', '·∫®m th·ª±c l√†ng qu√™', 'G√≥c kh√°m ph√°'];
            const pMap = ref({ 'Video ng·∫Øn': 0, 'Cu·ªôc s·ªëng th∆∞·ªùng ng√†y': 0, '·∫®m th·ª±c l√†ng qu√™': 0, 'G√≥c kh√°m ph√°': 0 });
            const itemsPerPage = ref(5);
            const isAutoplay = ref(true);
            const showLogin = ref(false);
            const passInput = ref('');
            const isAdm = ref(false);
            const newId = ref('');
            const newCat = ref('Video ng·∫Øn');
            const ip = ref('');

            const initPlayer = (id) => {
                if (ytPlayer && ytPlayer.loadVideoById) {
                    ytPlayer.loadVideoById(id);
                } else {
                    ytPlayer = new YT.Player('player', {
                        videoId: id,
                        playerVars: { 'autoplay': 1, 'rel': 0 },
                        events: {
                            'onStateChange': (e) => {
                                if (e.data === YT.PlayerState.ENDED && isAutoplay.value) playNext();
                            }
                        }
                    });
                }
            };

            const playNext = () => {
                const others = vids.value.filter(v => v.id !== cur.value.id);
                if (others.length > 0) play(others[Math.floor(Math.random() * others.length)]);
            };

            onMounted(async () => {
                const resiz = () => {
                    if(window.innerWidth > 1300) itemsPerPage.value = 5;
                    else if(window.innerWidth > 1100) itemsPerPage.value = 4;
                    else if(window.innerWidth > 650) itemsPerPage.value = 3;
                    else itemsPerPage.value = 2;
                };
                resiz(); window.addEventListener('resize', resiz);
                try {
                    const r = await fetch('https://api.ipify.org?format=json');
                    const d = await r.json();
                    ip.value = d.ip.replace(/\./g, '_');
                } catch(e) { ip.value = 'guest'; }

                db.ref('videos').on('value', s => {
                    const val = s.val();
                    if(val) {
                        const arr = Object.keys(val).map(k => ({key:k, ...val[k]})).reverse();
                        vids.value = arr;
                        if(!cur.value) {
                            cur.value = arr[0];
                            setTimeout(() => initPlayer(arr[0].id), 1200);
                        } else {
                            // C·∫≠p nh·∫≠t d·ªØ li·ªáu view/like cho video ƒëang ph√°t
                            const updated = arr.find(x => x.key === cur.value.key);
                            if(updated) cur.value = updated;
                        }
                    }
                });
            });

            const play = (v) => { 
                cur.value = v; 
                db.ref(`videos/${v.key}/views`).transaction(v => (v || 0) + 1); 
                initPlayer(v.id);
                window.scrollTo({top:0, behavior:'smooth'}); 
            };
            
            const checkPass = () => {
                if(passInput.value === 'cong1997') { isAdm.value = true; showLogin.value = false; passInput.value = ''; } 
                else { alert("Sai m√£ b·∫£o m·∫≠t!"); }
            };

            const vote = () => { 
                if(!cur.value || isLiked.value) return; 
                db.ref(`videos/${cur.value.key}/likes`).transaction(l => (l || 0) + 1); 
                db.ref(`videos/${cur.value.key}/voters/${ip.value}`).set(true); 
            };

            const isLiked = computed(() => cur.value && cur.value.voters && cur.value.voters[ip.value]);
            const suggest = computed(() => vids.value.filter(x => x.id !== cur.value?.id).sort(() => 0.5 - Math.random()).slice(0, 8));
            const list = (c) => vids.value.filter(x => x.category === c);
            const paged = (c) => list(c).slice(pMap.value[c]*itemsPerPage.value, (pMap.value[c]+1)*itemsPerPage.value);
            const isEnd = (c) => (pMap.value[c]+1)*itemsPerPage.value >= list(c).length;

            const saveVid = async () => {
                if(!newId.value) return;
                const r = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet&id=${newId.value}&key=AIzaSyBmx01zCKU5Z6XJcVTEurtcQrVq42iPSTM`);
                const d = await r.json();
                if(d.items && d.items[0]) {
                    db.ref('videos').push({ id: newId.value, title: d.items[0].snippet.title, category: newCat.value, views: 0, likes: 0 });
                    newId.value = ''; alert("Video ƒë√£ ƒë∆∞·ª£c l√™n s√≥ng!");
                } else { alert("ID Video kh√¥ng h·ª£p l·ªá!"); }
            };
            const del = (k) => { if(confirm("X√°c nh·∫≠n x√≥a b√†i vi·∫øt n√†y kh·ªèi h·ªá th·ªëng?")) db.ref('videos/'+k).remove(); };

            return { vids, cur, cats, pMap, itemsPerPage, isAutoplay, showLogin, passInput, isAdm, checkPass, newId, newCat, play, vote, isLiked, suggest, list, paged, isEnd, saveVid, del };
        }
    }).mount('#app');
};
</script>
</body>
</html>
